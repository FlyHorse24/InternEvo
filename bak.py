#1f1b
device_steps = [[('f', 0, 0, 0), ('f', 1, 0, 4), ('f', 2, 0, 8), ('f', 3, 0, 12), ('b', 0, 0, 34), ('b', 1, 0, 44), ('b', 2, 0, 54), ('b', 3, 0, 64)], 
                [('f', 0, 1, 4), ('f', 1, 1, 8), ('f', 2, 1, 12), ('b', 0, 1, 28), ('f', 3, 1, 34), ('b', 1, 1, 38), ('b', 2, 1, 48), ('b', 3, 1, 58)], 
                [('f', 0, 2, 8), ('f', 1, 2, 12), ('b', 0, 2, 22), ('f', 2, 2, 28), ('b', 1, 2, 32), ('f', 3, 2, 38), ('b', 2, 2, 42), ('b', 3, 2, 52)], 
                [('f', 0, 3, 12), ('b', 0, 3, 16), ('f', 1, 3, 22), ('b', 1, 3, 26), ('f', 2, 3, 32), ('b', 2, 3, 36), ('f', 3, 3, 42), ('b', 3, 3, 46)]]    
    # print(f'device:{get_current_device()}')
    # print(f'local_rank:{gpc.get_local_rank(ParallelMode.PIPELINE)}')
    # print(f'ranks_in_group:{gpc.get_ranks_in_group(ParallelMode.PIPELINE)}')
    # print(f'global_rank:{gpc.get_global_rank()}')
    # print(f'prev_rank:{gpc.get_prev_global_rank(ParallelMode.PIPELINE)}')
    # print(f'next_rank:{gpc.get_next_global_rank(ParallelMode.PIPELINE)}')
    # print(f'ops:{len(ops)}')
    # print(f'p2p_time_local_rank:{gpc.get_local_rank(ParallelMode.PIPELINE)}')

device_steps = [[('f', 0, 0, 0, False, False), ('f', 1, 0, 6, False, False), ('f', 2, 0, 12, False, False), ('f', 3, 0, 18, False, False), ('f', 4, 0, 24, False, False), ('f', 5, 0, 30, False, False), ('f', 6, 0, 36, False, False), ('f', 7, 0, 42, False, False), ('f', 8, 0, 48, False, False), ('f', 9, 0, 54, False, False), ('f', 10, 0, 60, False, False), ('f', 11, 0, 66, False, False), ('f', 12, 0, 72, False, False), ('f', 13, 0, 78, False, False), ('f', 14, 0, 84, False, False), ('f', 15, 0, 90, False, False), ('b', 0, 0, 138, False, False), ('b', 1, 0, 164, False, False), ('b', 2, 0, 188, False, False), ('b', 3, 0, 204, False, False), ('b', 4, 0, 218, False, False), ('b', 5, 0, 232, False, False), ('b', 6, 0, 246, False, False), ('b', 7, 0, 260, False, False), ('b', 8, 0, 274, False, False), ('b', 9, 0, 288, False, False), ('b', 10, 0, 298, False, False), ('b', 11, 0, 316, False, False), ('b', 12, 0, 330, False, False), ('b', 13, 0, 344, False, False), ('b', 14, 0, 358, False, False), ('b', 15, 0, 372, False, False)], 
                [('f', 0, 1, 7, False, False), ('f', 1, 1, 13, False, False), ('f', 2, 1, 19, False, False), ('f', 3, 1, 25, False, False), ('f', 4, 1, 31, False, False), ('f', 5, 1, 37, False, False), ('f', 6, 1, 43, False, False), ('f', 7, 1, 49, False, False), ('f', 8, 1, 55, False, False), ('f', 9, 1, 61, False, False), ('f', 10, 1, 67, False, False), ('f', 11, 1, 73, False, False), ('f', 12, 1, 79, False, False), ('f', 13, 1, 85, False, False), ('f', 14, 1, 91, False, False), ('f', 15, 1, 97, False, False), ('b', 0, 1, 127, False, True), ('b', 1, 1, 153, False, False), ('b', 2, 1, 177, False, False), ('b', 3, 1, 193, False, False), ('b', 4, 1, 203, False, False), ('b', 5, 1, 221, False, False), ('b', 6, 1, 235, False, False), ('b', 7, 1, 249, False, False), ('b', 8, 1, 263, False, False), ('b', 9, 1, 277, False, False), ('b', 10, 1, 287, False, False), ('b', 11, 1, 305, False, False), ('b', 12, 1, 319, False, False), ('b', 13, 1, 333, False, False), ('b', 14, 1, 347, False, False), ('b', 15, 1, 361, False, False)], 
                [('f', 0, 2, 14, False, False), ('f', 1, 2, 20, False, False), ('f', 2, 2, 26, False, False), ('f', 3, 2, 32, False, False), ('f', 4, 2, 38, False, False), ('f', 5, 2, 44, False, False), ('f', 6, 2, 50, False, False), ('f', 7, 2, 56, False, False), ('f', 8, 2, 62, False, False), ('f', 9, 2, 68, False, False), ('f', 10, 2, 74, False, False), ('f', 11, 2, 80, False, False), ('f', 12, 2, 86, False, False), ('f', 13, 2, 92, False, False), ('f', 14, 2, 98, True, False), ('f', 15, 2, 104, True, False), ('b', 0, 2, 116, False, True), ('b', 1, 2, 142, False, False), ('b', 2, 2, 166, False, False), ('b', 3, 2, 182, False, False), ('b', 4, 2, 192, False, False), ('b', 5, 2, 210, False, False), ('b', 6, 2, 224, False, False), ('b', 7, 2, 238, False, False), ('b', 8, 2, 252, False, False), ('b', 9, 2, 266, False, False), ('b', 10, 2, 276, False, False), ('b', 11, 2, 293, False, False), ('b', 12, 2, 308, False, False), ('b', 13, 2, 322, False, False), ('b', 14, 2, 336, False, False), ('b', 15, 2, 350, False, False)], 
                [('f', 0, 3, 21, False, False), ('f', 1, 3, 27, False, False), ('f', 2, 3, 33, False, False), ('f', 3, 3, 39, False, False), ('f', 4, 3, 45, False, False), ('f', 5, 3, 51, False, False), ('f', 6, 3, 57, False, False), ('f', 7, 3, 63, False, False), ('f', 8, 3, 69, False, False), ('f', 9, 3, 75, False, False), ('f', 10, 3, 81, False, False), ('f', 11, 3, 87, True, False), ('f', 12, 3, 93, False, False), ('f', 13, 3, 99, True, False), ('b', 0, 3, 105, False, True), ('b', 1, 3, 131, False, False), ('f', 14, 3, 145, True, False), ('b', 2, 3, 155, False, False), ('f', 15, 3, 165, True, False), ('b', 3, 3, 171, False, False), ('b', 4, 3, 181, False, False), ('b', 5, 3, 199, False, False), ('b', 6, 3, 213, False, False), ('b', 7, 3, 227, False, False), ('b', 8, 3, 241, False, False), ('b', 9, 3, 255, False, False), ('b', 10, 3, 265, False, False), ('b', 11, 3, 282, False, False), ('b', 12, 3, 297, False, False), ('b', 13, 3, 311, False, False), ('b', 14, 3, 325, False, False), ('b', 15, 3, 339, False, False)], 
                [('f', 0, 4, 28, False, False), ('f', 1, 4, 34, False, False), ('f', 2, 4, 40, False, False), ('f', 3, 4, 46, False, False), ('f', 4, 4, 52, False, False), ('f', 5, 4, 58, False, False), ('f', 6, 4, 64, False, False), ('f', 7, 4, 70, False, False), ('f', 8, 4, 76, True, False), ('f', 9, 4, 82, False, False), ('f', 10, 4, 88, True, False), ('b', 0, 4, 94, False, True), ('f', 11, 4, 104, False, False), ('f', 12, 4, 110, True, False), ('b', 1, 4, 120, False, False), ('b', 2, 4, 144, False, True), ('f', 13, 4, 154, True, False), ('b', 3, 4, 160, False, True), ('b', 4, 4, 170, False, False), ('f', 14, 4, 182, True, False), ('b', 5, 4, 188, False, False), ('b', 6, 4, 198, False, False), ('f', 15, 4, 210, True, False), ('b', 7, 4, 216, False, False), ('b', 8, 4, 228, False, False), ('b', 9, 4, 244, False, False), ('b', 10, 4, 254, False, False), ('b', 11, 4, 271, False, False), ('b', 12, 4, 286, False, False), ('b', 13, 4, 300, False, False), ('b', 14, 4, 314, False, False), ('b', 15, 4, 328, False, False)], 
                [('f', 0, 5, 35, False, False), ('f', 1, 5, 41, False, False), ('f', 2, 5, 47, False, False), ('f', 3, 5, 53, False, False), ('f', 4, 5, 59, True, False), ('f', 5, 5, 65, False, False), ('f', 6, 5, 71, False, False), ('f', 7, 5, 77, True, False), ('b', 0, 5, 83, False, True), ('f', 8, 5, 93, False, False), ('f', 9, 5, 99, True, False), ('b', 1, 5, 109, False, True), ('f', 10, 5, 119, True, False), ('f', 11, 5, 125, True, False), ('b', 2, 5, 133, False, False), ('b', 3, 5, 143, False, True), ('b', 4, 5, 153, False, False), ('f', 12, 5, 163, True, False), ('b', 5, 5, 169, False, True), ('f', 13, 5, 179, True, False), ('b', 6, 5, 185, False, False), ('f', 14, 5, 199, True, False), ('b', 7, 5, 205, False, True), ('b', 8, 5, 217, False, False), ('f', 15, 5, 227, True, False), ('b', 9, 5, 233, False, False), ('b', 10, 5, 243, False, False), ('b', 11, 5, 260, False, False), ('b', 12, 5, 274, False, False), ('b', 13, 5, 289, False, False), ('b', 14, 5, 303, False, False), ('b', 15, 5, 317, False, False)], 
                [('f', 0, 6, 42, False, False), ('f', 1, 6, 48, True, False), ('f', 2, 6, 54, True, False), ('f', 3, 6, 60, False, False), ('b', 0, 6, 66, False, True), ('f', 4, 6, 80, False, False), ('f', 5, 6, 86, False, False), ('f', 6, 6, 92, False, False), ('b', 1, 6, 98, False, True), ('f', 7, 6, 108, True, False), ('f', 8, 6, 114, True, False), ('b', 2, 6, 122, False, True), ('b', 3, 6, 132, False, False), ('b', 4, 6, 142, False, False), ('f', 9, 6, 152, True, False), ('b', 5, 6, 158, False, True), ('f', 10, 6, 168, True, False), ('b', 6, 6, 174, False, True), ('f', 11, 6, 184, True, False), ('b', 7, 6, 194, False, True), ('b', 8, 6, 204, False, False), ('f', 12, 6, 214, True, False), ('b', 9, 6, 220, False, True), ('b', 10, 6, 230, False, False), ('f', 13, 6, 240, True, False), ('b', 11, 6, 246, False, False), ('f', 14, 6, 256, True, False), ('b', 12, 6, 262, False, False), ('f', 15, 6, 272, True, False), ('b', 13, 6, 278, False, False), ('b', 14, 6, 292, False, False), ('b', 15, 6, 306, False, False)], 
                [('f', 0, 7, 49, False, False), ('b', 0, 7, 55, False, True), ('f', 1, 7, 65, False, False), ('b', 1, 7, 71, False, True), ('f', 2, 7, 81, False, False), ('f', 3, 7, 87, False, False), ('f', 4, 7, 93, False, False), ('f', 5, 7, 99, False, False), ('f', 6, 7, 105, False, False), ('b', 2, 7, 111, False, True), ('b', 3, 7, 121, False, False), ('b', 4, 7, 131, False, False), ('f', 7, 7, 141, False, False), ('b', 5, 7, 147, False, True), ('f', 8, 7, 157, False, False), ('b', 6, 7, 163, False, True), ('f', 9, 7, 173, False, False), ('b', 7, 7, 179, False, True), ('b', 8, 7, 189, False, False), ('f', 10, 7, 199, False, False), ('b', 9, 7, 205, False, True), ('b', 10, 7, 215, False, False), ('f', 11, 7, 225, False, False), ('b', 11, 7, 231, False, True), ('f', 12, 7, 241, False, False), ('b', 12, 7, 247, False, True), ('f', 13, 7, 257, False, False), ('b', 13, 7, 263, False, True), ('f', 14, 7, 273, False, False), ('b', 14, 7, 279, False, False), ('f', 15, 7, 289, False, False), ('b', 15, 7, 295, False, False)]]
   